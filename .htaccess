# .htaccess dla Node.js z Phusion Passenger
# TYMCZASOWA NAPRAWA PĘTLI PRZEKIEROWAŃ:
# - Wyłączono FilesMatch i mod_deflate (konflikt z Passenger)
# - Passenger obsługuje pliki statyczne automatycznie

# Włącz przyjazne strony błędów
PassengerFriendlyErrorPages on

# KONFIGURACJA PASSENGER DLA NODE.JS
PassengerEnabled on
PassengerAppType node
PassengerStartupFile app.js
PassengerAppEnv production

# Jeśli potrzebujesz określić ścieżkę do Node.js:
# PassengerNodejs /usr/bin/node

# Passenger obsługuje wszystkie requesty automatycznie

# Security Headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# CORS (jeśli potrzebne)
# Header always set Access-Control-Allow-Origin "*"

# TYMCZASOWO WYŁĄCZONE - powodowały konflikt z Passenger
# Cache Control dla plików statycznych
# <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
#     ExpiresActive On
#     ExpiresDefault "access plus 1 month"
#     Header set Cache-Control "public, immutable"
# </FilesMatch>

# Gzip Compression
# <IfModule mod_deflate.c>
#     AddOutputFilterByType DEFLATE text/plain
#     AddOutputFilterByType DEFLATE text/html
#     AddOutputFilterByType DEFLATE text/xml
#     AddOutputFilterByType DEFLATE text/css
#     AddOutputFilterByType DEFLATE application/xml
#     AddOutputFilterByType DEFLATE application/xhtml+xml
#     AddOutputFilterByType DEFLATE application/rss+xml
#     AddOutputFilterByType DEFLATE application/javascript
#     AddOutputFilterByType DEFLATE application/x-javascript
#     AddOutputFilterByType DEFLATE application/json
# </IfModule>

# Custom Error Pages - DISABLED to prevent redirect loops
# ErrorDocument 404 /error
# ErrorDocument 500 /error
# Node.js handles errors internally

# Protect sensitive files
<FilesMatch "^(\.env|\.git|package\.json|package-lock\.json|node_modules)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent directory browsing
Options -Indexes
