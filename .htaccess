# .htaccess dla Node.js z Apache Reverse Proxy (port 3002)
# NAPRAWA: Zastąpiono Passenger reverse proxy
# - Aplikacja Node.js działa na porcie 3002
# - Apache przekierowuje wszystkie żądania na localhost:3002

# Włącz mod_rewrite
RewriteEngine On

# Przekieruj wszystko na Node.js (port 3002)
RewriteRule ^$ http://127.0.0.1:3002/ [P,L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ http://127.0.0.1:3002/$1 [P,L]

# Ustaw nagłówki proxy
ProxyPreserveHost On
ProxyPass / http://127.0.0.1:3002/
ProxyPassReverse / http://127.0.0.1:3002/

# Security Headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# CORS (jeśli potrzebne)
# Header always set Access-Control-Allow-Origin "*"

# UWAGA: Wszystkie pliki statyczne (CSS, JS, obrazy) są teraz obsługiwane przez Node.js
# Express.static w app.js obsługuje pliki z folderu public/

# TYMCZASOWO WYŁĄCZONE - powodowały konflikt z Passenger
# Cache Control dla plików statycznych
# <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
#     ExpiresActive On
#     ExpiresDefault "access plus 1 month"
#     Header set Cache-Control "public, immutable"
# </FilesMatch>

# Gzip Compression
# <IfModule mod_deflate.c>
#     AddOutputFilterByType DEFLATE text/plain
#     AddOutputFilterByType DEFLATE text/html
#     AddOutputFilterByType DEFLATE text/xml
#     AddOutputFilterByType DEFLATE text/css
#     AddOutputFilterByType DEFLATE application/xml
#     AddOutputFilterByType DEFLATE application/xhtml+xml
#     AddOutputFilterByType DEFLATE application/rss+xml
#     AddOutputFilterByType DEFLATE application/javascript
#     AddOutputFilterByType DEFLATE application/x-javascript
#     AddOutputFilterByType DEFLATE application/json
# </IfModule>

# Custom Error Pages - DISABLED to prevent redirect loops
# ErrorDocument 404 /error
# ErrorDocument 500 /error
# Node.js handles errors internally

# Protect sensitive files
<FilesMatch "^(\.env|\.git|package\.json|package-lock\.json|node_modules)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent directory browsing
Options -Indexes
